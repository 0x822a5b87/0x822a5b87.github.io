<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 8.1.1">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css" integrity="sha256-VHqXKFhhMxcpubYf9xiWdCiojEbY9NexQ4jh8AxbvcM=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"0x822a5b87.github.io","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.26.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"codeblock":{"theme":{"light":"stackoverflow-light","dark":"stackoverflow-light"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":true,"style":"flat"},"fold":{"enable":false,"height":500},"language":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"utterances","storage":true,"lazyload":false,"nav":null,"activeClass":"utterances"},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js" defer></script>

    <meta name="description" content="pprof pprof 是 golang 内置的一种用于调优和性能分析的工具，有三种最常用的方式使用：  ​ 在启动时引入 &quot;net&#x2F;http&#x2F;pprof&quot; 包，在包中会初始化一个http服务，随后可以通过http服务对pprof进行访问； 通过 wget 的方式访问 &#x2F;debug&#x2F;pprof&#x2F;profile 接口（也需要通过1监听http端口）下载文件，文件可以通过 go tool pprof">
<meta property="og:type" content="article">
<meta property="og:title" content="golang性能分析">
<meta property="og:url" content="https://0x822a5b87.github.io/2024/05/11/golang%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90%E5%8F%8ADEBUG%E5%B7%A5%E5%85%B7/index.html">
<meta property="og:site_name" content="0x822a5b87的博客">
<meta property="og:description" content="pprof pprof 是 golang 内置的一种用于调优和性能分析的工具，有三种最常用的方式使用：  ​ 在启动时引入 &quot;net&#x2F;http&#x2F;pprof&quot; 包，在包中会初始化一个http服务，随后可以通过http服务对pprof进行访问； 通过 wget 的方式访问 &#x2F;debug&#x2F;pprof&#x2F;profile 接口（也需要通过1监听http端口）下载文件，文件可以通过 go tool pprof">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://0x822a5b87.github.io/2024/05/11/images/002/debug-pprof.png">
<meta property="og:image" content="https://0x822a5b87.github.io/2024/05/11/images/002/profile.png">
<meta property="og:image" content="https://0x822a5b87.github.io/2024/05/11/images/002/profile001.png">
<meta property="og:image" content="https://0x822a5b87.github.io/2024/05/11/images/002/pprof-web.png">
<meta property="og:image" content="https://0x822a5b87.github.io/2024/05/11/images/002/pprof-code.png">
<meta property="article:published_time" content="2024-05-11T07:35:53.000Z">
<meta property="article:modified_time" content="2026-01-22T03:59:57.113Z">
<meta property="article:author" content="2183814023">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://0x822a5b87.github.io/2024/05/11/images/002/debug-pprof.png">


<link rel="canonical" href="https://0x822a5b87.github.io/2024/05/11/golang%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90%E5%8F%8ADEBUG%E5%B7%A5%E5%85%B7/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://0x822a5b87.github.io/2024/05/11/golang%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90%E5%8F%8ADEBUG%E5%B7%A5%E5%85%B7/","path":"2024/05/11/golang性能分析及DEBUG工具/","title":"golang性能分析"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>golang性能分析 | 0x822a5b87的博客</title>
  








  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
<script src="/js/utils.js" defer></script><script src="/js/motion.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/next-boot.js" defer></script>

  

  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/11.10.1/mermaid.min.js","integrity":"sha256-BmQmdWDS8X2OTbrwELWK366LV6escyWhHHe0XCTU/Hk="}}</script>
  <script src="/js/third-party/tags/mermaid.js" defer></script>





  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"all","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js" defer></script>



  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">0x822a5b87的博客</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">到码头整点薯条吃</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#pprof"><span class="nav-number">1.</span> <span class="nav-text">pprof</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#nethttppprof"><span class="nav-number">1.1.</span> <span class="nav-text">net&#x2F;http&#x2F;pprof</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#example"><span class="nav-number">1.2.</span> <span class="nav-text">example</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#usage"><span class="nav-number">1.3.</span> <span class="nav-text">usage</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#http%E6%9C%8D%E5%8A%A1"><span class="nav-number">1.3.1.</span> <span class="nav-text">http服务</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#interactive-terminal"><span class="nav-number">1.3.2.</span> <span class="nav-text">interactive terminal</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#cpu-profiling"><span class="nav-number">1.3.2.1.</span> <span class="nav-text">CPU profiling</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#heap"><span class="nav-number">1.3.2.2.</span> <span class="nav-text">heap</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#go-tool-pprof"><span class="nav-number">1.3.3.</span> <span class="nav-text">go tool pprof</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#go-test"><span class="nav-number">1.3.4.</span> <span class="nav-text">go test</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#delve"><span class="nav-number">2.</span> <span class="nav-text">delve</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#golang-debugging-code-example"><span class="nav-number">2.1.</span> <span class="nav-text">Golang Debugging Code
Example</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#stack"><span class="nav-number">2.2.</span> <span class="nav-text">stack</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#goroutine%E5%92%8Cgoroutines"><span class="nav-number">2.3.</span> <span class="nav-text">goroutine和goroutines</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#frame"><span class="nav-number">2.4.</span> <span class="nav-text">frame</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#list"><span class="nav-number">2.5.</span> <span class="nav-text">list</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BC%95%E7%94%A8"><span class="nav-number">3.</span> <span class="nav-text">引用</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">2183814023</p>
  <div class="site-description" itemprop="description">到码头整点薯条吃</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">43</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">39</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://0x822a5b87.github.io/2024/05/11/golang%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90%E5%8F%8ADEBUG%E5%B7%A5%E5%85%B7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="2183814023">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="0x822a5b87的博客">
      <meta itemprop="description" content="到码头整点薯条吃">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="golang性能分析 | 0x822a5b87的博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          golang性能分析
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-05-11 15:35:53" itemprop="dateCreated datePublished" datetime="2024-05-11T15:35:53+08:00">2024-05-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2026-01-22 11:59:57" itemprop="dateModified" datetime="2026-01-22T11:59:57+08:00">2026-01-22</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h2 id="pprof">pprof</h2>
<p>pprof 是 golang
内置的一种用于调优和性能分析的工具，有三种最常用的方式使用：</p>
<ol type="1">
<li>​ 在启动时引入 <code>"net/http/pprof"</code>
包，在包中会初始化一个http服务，随后可以通过http服务对pprof进行访问；</li>
<li>通过 <code>wget</code> 的方式访问 <code>/debug/pprof/profile</code>
接口（也需要通过<code>1</code>监听http端口）下载文件，文件可以通过
<code>go tool pprof</code> 打开并进入可视化界面；</li>
<li>通过 <code>go test</code> 进入测试用例剖析；</li>
</ol>
<h3 id="nethttppprof">net/http/pprof</h3>
<p>如果我们想要使用pprof服务，可以通过如下两种方式开启：</p>
<blockquote>
<p>使用默认的handler</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;net/http&quot;</span></span><br><span class="line">	_ <span class="string">&quot;net/http/pprof&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	_ = http.ListenAndServe(<span class="string">&quot;0.0.0.0:6060&quot;</span>, <span class="literal">nil</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>监听指定的端口</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;log&quot;</span></span><br><span class="line">	<span class="string">&quot;net/http&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> PprofPort = <span class="number">19090</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	address := fmt.Sprintf(<span class="string">&quot;0.0.0.0:%d&quot;</span>, PprofPort)</span><br><span class="line"></span><br><span class="line">	pprofServer := &amp;http.Server&#123;</span><br><span class="line">		Addr:    address,</span><br><span class="line">		Handler: http.DefaultServeMux,</span><br><span class="line">	&#125;</span><br><span class="line">	err := pprofServer.ListenAndServe()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatalf(<span class="string">&quot;error start pprof server : %s\n&quot;</span>, err.Error())</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以看到，最简单的方式只需要引入 <code>net/http/pprof</code>
包之后，再监听http端口即可，因为在pprof包的初始化的过程中存在如下 init()
代码</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line">	http.HandleFunc(<span class="string">&quot;/debug/pprof/&quot;</span>, Index)</span><br><span class="line">	http.HandleFunc(<span class="string">&quot;/debug/pprof/cmdline&quot;</span>, Cmdline)</span><br><span class="line">	http.HandleFunc(<span class="string">&quot;/debug/pprof/profile&quot;</span>, Profile)</span><br><span class="line">	http.HandleFunc(<span class="string">&quot;/debug/pprof/symbol&quot;</span>, Symbol)</span><br><span class="line">	http.HandleFunc(<span class="string">&quot;/debug/pprof/trace&quot;</span>, Trace)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>而这里将默认的handler绑定到了
<code>DefaultServeMux</code>，这个是http服务默认的handler</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">HandleFunc</span><span class="params">(pattern <span class="type">string</span>, handler <span class="keyword">func</span>(ResponseWriter, *Request)</span></span>) &#123;</span><br><span class="line">	DefaultServeMux.HandleFunc(pattern, handler)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="example">example</h3>
<blockquote>
<p>以下是我们调试用的示例代码。</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;log&quot;</span></span><br><span class="line">	<span class="string">&quot;net/http&quot;</span></span><br><span class="line">	_ <span class="string">&quot;net/http/pprof&quot;</span></span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> dataList []<span class="type">string</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Add</span><span class="params">(str <span class="type">string</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">	<span class="comment">// This code is to ensure that it takes up more CPU to ensure better debugging</span></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10000000000</span>; i++ &#123;</span><br><span class="line">		<span class="keyword">if</span> i%<span class="number">100000000</span> == <span class="number">0</span> &#123;</span><br><span class="line">			log.Printf(<span class="string">&quot;add\n&quot;</span>)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	data := []<span class="type">byte</span>(str)</span><br><span class="line">	dataList = <span class="built_in">append</span>(dataList, <span class="type">string</span>(data))</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">len</span>(dataList)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		<span class="keyword">for</span> &#123;</span><br><span class="line">			log.Printf(<span class="string">&quot;len: %d&quot;</span>, Add(<span class="string">&quot;go-programming-tour-book&quot;</span>))</span><br><span class="line">			time.Sleep(time.Millisecond * <span class="number">10</span>)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;()</span><br><span class="line"></span><br><span class="line">	_ = http.ListenAndServe(<span class="string">&quot;0.0.0.0:6060&quot;</span>, <span class="literal">nil</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="usage">usage</h3>
<h4 id="http服务">http服务</h4>
<blockquote>
<p>执行 <code>go run main.go</code> 之后，可以通过
<code>http://localhost:6060/debug/pprof/</code> 进入 pprof
http服务。</p>
</blockquote>
<figure>
<img src="../images/002/debug-pprof.png" alt="debug-pprof" />
<figcaption aria-hidden="true">debug-pprof</figcaption>
</figure>
<p>显示的信息很简单，如文档描述：</p>
<ul>
<li>allocs: A sampling of all past memory allocations</li>
<li>block: Stack traces that led to blocking on synchronization
primitives</li>
<li>cmdline: The command line invocation of the current program</li>
<li>goroutine: Stack traces of all current goroutines</li>
<li>heap: A sampling of memory allocations of live objects. You can
specify the gc GET parameter to run GC before taking the heap
sample.</li>
<li>mutex: Stack traces of holders of contended mutexes</li>
<li>profile: CPU profile. You can specify the duration in the seconds
GET parameter. After you get the profile file, use the go tool pprof
command to investigate the profile.</li>
<li>threadcreate: Stack traces that led to the creation of new OS
threads</li>
<li>trace: A trace of execution of the current program. You can specify
the duration in the seconds GET parameter. After you get the trace file,
use the go tool trace command to investigate the trace.</li>
</ul>
<p>这里值得一提的是
<code>profile</code>，它会在经过一段时间的分析后生成一个报告，这个报告可以基于
<code>go tool pprof</code> 打开。</p>
<h4 id="interactive-terminal">interactive terminal</h4>
<h5 id="cpu-profiling">CPU profiling</h5>
<p>在命令行执行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go tool pprof http://localhost:6060/debug/pprof/profile?seconds=60</span><br></pre></td></tr></table></figure>
<p>该命令会在进行60秒的profile之后，进入一个交互终端：</p>
<figure>
<img src="../images/002/profile.png" alt="profile" />
<figcaption aria-hidden="true">profile</figcaption>
</figure>
<p>在交互终端，我们可以通过各种方式来进行CPU相关的分析：</p>
<blockquote>
<p>查看占用CPU前10的函数</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">top</span><br></pre></td></tr></table></figure>
<p>得到结果</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Showing</span> nodes accounting for <span class="number">45</span>.<span class="number">33</span>s, <span class="number">99</span>.<span class="number">80</span>% of <span class="number">45</span>.<span class="number">42</span>s total</span><br><span class="line"><span class="attribute">Dropped</span> <span class="number">14</span> nodes (cum &lt;= <span class="number">0</span>.<span class="number">23</span>s)</span><br><span class="line"><span class="attribute">Showing</span> top <span class="number">10</span> nodes out of <span class="number">18</span></span><br><span class="line">      <span class="attribute">flat</span>  flat%   sum%        cum   cum%</span><br><span class="line">    <span class="attribute">39</span>.<span class="number">61</span>s <span class="number">87</span>.<span class="number">21</span>% <span class="number">87</span>.<span class="number">21</span>%     <span class="number">44</span>.<span class="number">93</span>s <span class="number">98</span>.<span class="number">92</span>%  main.Add</span><br><span class="line">     <span class="attribute">3</span>.<span class="number">47</span>s  <span class="number">7</span>.<span class="number">64</span>% <span class="number">94</span>.<span class="number">85</span>%      <span class="number">3</span>.<span class="number">47</span>s  <span class="number">7</span>.<span class="number">64</span>%  runtime.asyncPreempt</span><br><span class="line">     <span class="attribute">1</span>.<span class="number">87</span>s  <span class="number">4</span>.<span class="number">12</span>% <span class="number">98</span>.<span class="number">97</span>%      <span class="number">1</span>.<span class="number">87</span>s  <span class="number">4</span>.<span class="number">12</span>%  syscall.syscall</span><br><span class="line">     <span class="attribute">0</span>.<span class="number">38</span>s  <span class="number">0</span>.<span class="number">84</span>% <span class="number">99</span>.<span class="number">80</span>%      <span class="number">0</span>.<span class="number">38</span>s  <span class="number">0</span>.<span class="number">84</span>%  runtime.kevent</span><br><span class="line">         <span class="attribute">0</span>     <span class="number">0</span>% <span class="number">99</span>.<span class="number">80</span>%      <span class="number">1</span>.<span class="number">87</span>s  <span class="number">4</span>.<span class="number">12</span>%  internal/poll.(*FD).Write</span><br><span class="line">         <span class="attribute">0</span>     <span class="number">0</span>% <span class="number">99</span>.<span class="number">80</span>%      <span class="number">1</span>.<span class="number">87</span>s  <span class="number">4</span>.<span class="number">12</span>%  internal/poll.ignoringEINTRIO (inline)</span><br><span class="line">         <span class="attribute">0</span>     <span class="number">0</span>% <span class="number">99</span>.<span class="number">80</span>%      <span class="number">1</span>.<span class="number">87</span>s  <span class="number">4</span>.<span class="number">12</span>%  log.(*Logger).Output</span><br><span class="line">         <span class="attribute">0</span>     <span class="number">0</span>% <span class="number">99</span>.<span class="number">80</span>%      <span class="number">1</span>.<span class="number">88</span>s  <span class="number">4</span>.<span class="number">14</span>%  log.Printf</span><br><span class="line">         <span class="attribute">0</span>     <span class="number">0</span>% <span class="number">99</span>.<span class="number">80</span>%     <span class="number">44</span>.<span class="number">96</span>s <span class="number">98</span>.<span class="number">99</span>%  main.main.func1</span><br><span class="line">         <span class="attribute">0</span>     <span class="number">0</span>% <span class="number">99</span>.<span class="number">80</span>%      <span class="number">1</span>.<span class="number">87</span>s  <span class="number">4</span>.<span class="number">12</span>%  os.(*File).Write</span><br></pre></td></tr></table></figure>
<p>可以看到，我们的 <code>main.Add</code> 函数占用了最多的CPU时间。</p>
<h5 id="heap">heap</h5>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go tool pprof http://localhost:6060/debug/pprof/heap</span><br></pre></td></tr></table></figure>
<p>这里会立即进入而不需要等待采样时间，因为堆上的数据和CPU数据不一样，是在程序执行期间一直存在的。</p>
<blockquote>
<p>也可以查看堆内存使用前10</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">top</span><br></pre></td></tr></table></figure>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Showing</span> nodes accounting for <span class="number">3587</span>.<span class="number">42</span>kB, <span class="number">100</span>% of <span class="number">3587</span>.<span class="number">42</span>kB total</span><br><span class="line"><span class="attribute">Showing</span> top <span class="number">10</span> nodes out of <span class="number">26</span></span><br><span class="line">      <span class="attribute">flat</span>  flat%   sum%        cum   cum%</span><br><span class="line"> <span class="attribute">2562</span>.<span class="number">81</span>kB <span class="number">71</span>.<span class="number">44</span>% <span class="number">71</span>.<span class="number">44</span>%  <span class="number">2562</span>.<span class="number">81</span>kB <span class="number">71</span>.<span class="number">44</span>%  runtime.allocm</span><br><span class="line">  <span class="attribute">512</span>.<span class="number">56</span>kB <span class="number">14</span>.<span class="number">29</span>% <span class="number">85</span>.<span class="number">73</span>%   <span class="number">512</span>.<span class="number">56</span>kB <span class="number">14</span>.<span class="number">29</span>%  syscall.runtime_envs</span><br><span class="line">  <span class="attribute">512</span>.<span class="number">05</span>kB <span class="number">14</span>.<span class="number">27</span>%   <span class="number">100</span>%   <span class="number">512</span>.<span class="number">05</span>kB <span class="number">14</span>.<span class="number">27</span>%  runtime.acquireSudog</span><br><span class="line">         <span class="attribute">0</span>     <span class="number">0</span>%   <span class="number">100</span>%   <span class="number">512</span>.<span class="number">56</span>kB <span class="number">14</span>.<span class="number">29</span>%  runtime.doInit</span><br><span class="line">         <span class="attribute">0</span>     <span class="number">0</span>%   <span class="number">100</span>%   <span class="number">512</span>.<span class="number">05</span>kB <span class="number">14</span>.<span class="number">27</span>%  runtime.gcBgMarkWorker</span><br><span class="line">         <span class="attribute">0</span>     <span class="number">0</span>%   <span class="number">100</span>%   <span class="number">512</span>.<span class="number">05</span>kB <span class="number">14</span>.<span class="number">27</span>%  runtime.gcMarkDone</span><br><span class="line">         <span class="attribute">0</span>     <span class="number">0</span>%   <span class="number">100</span>%   <span class="number">512</span>.<span class="number">56</span>kB <span class="number">14</span>.<span class="number">29</span>%  runtime.gopreempt_m</span><br><span class="line">         <span class="attribute">0</span>     <span class="number">0</span>%   <span class="number">100</span>%   <span class="number">512</span>.<span class="number">56</span>kB <span class="number">14</span>.<span class="number">29</span>%  runtime.goschedImpl</span><br><span class="line">         <span class="attribute">0</span>     <span class="number">0</span>%   <span class="number">100</span>%   <span class="number">512</span>.<span class="number">56</span>kB <span class="number">14</span>.<span class="number">29</span>%  runtime.handoffp</span><br><span class="line">         <span class="attribute">0</span>     <span class="number">0</span>%   <span class="number">100</span>%   <span class="number">512</span>.<span class="number">56</span>kB <span class="number">14</span>.<span class="number">29</span>%  runtime.main</span><br></pre></td></tr></table></figure>
<p>除此之外，还可以对 <code>mutex</code>, <code>goroutine</code>
等进行分析。</p>
<h4 id="go-tool-pprof">go tool pprof</h4>
<p>以上的分析方式其实更适用于线上的简单情况分析，而在生产环境的应用场景下，我更倾向于直接使用
<code>go tool pprof</code>
来进行分析，因为大部分情况下操作更简单和直观。<strong>以下的例子是对CPU使用的一个分析示例</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 首先我们通过 wget 下载数据。</span></span><br><span class="line"><span class="comment"># 需要等待30s采样时间</span></span><br><span class="line">wget http://127.0.0.1:6060/debug/pprof/profile -O cpu.profile</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果我们要对heap进行分析，修改下载的文件即可</span></span><br><span class="line">wget http://127.0.0.1:6060/debug/pprof/heap -O heap.profile</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在浏览器中打开文件</span></span><br><span class="line">go tool pprof -http=:6001 cpu.profile</span><br></pre></td></tr></table></figure>
<figure>
<img src="../images/002/profile001.png" alt="profile-image" />
<figcaption aria-hidden="true">profile-image</figcaption>
</figure>
<p>最终生成的结果图如上所示。</p>
<p>页面包含了如下所示的页面：</p>
<figure>
<img src="../images/002/pprof-web.png" alt="pprof-web" />
<figcaption aria-hidden="true">pprof-web</figcaption>
</figure>
<ul>
<li>top 对应于交互终端的top命令</li>
<li>graph 对应于上面的图示</li>
<li>flame graph 火焰图</li>
<li>peek 和top命令功能一样，但是相对的增加了调用者/被调用者的信息</li>
<li>source
<strong>和top命令功能一样，但是相对增加了代码的信息</strong>，这个是我个人比较喜欢的一个功能</li>
<li>disassemble 很少用到这么底层的信息</li>
</ul>
<blockquote>
<p>下面是 <code>source</code>
接口的返回，我们可以很清晰的看到，整个程序中占用CPU最多的就是
<code>Add</code> 函数和 <code>log.Printf</code> 函数。而
<code>log.Printf</code> 中调用了 <code>Add</code> 函数。</p>
</blockquote>
<figure>
<img src="../images/002/pprof-code.png" alt="pprof-code" />
<figcaption aria-hidden="true">pprof-code</figcaption>
</figure>
<h4 id="go-test">go test</h4>
<blockquote>
<p>add.go</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> add</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;log&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> dataList []<span class="type">string</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Add</span><span class="params">(str <span class="type">string</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">	<span class="comment">// This code is to ensure that it takes up more CPU to ensure better debugging</span></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10000000000</span>; i++ &#123;</span><br><span class="line">		<span class="keyword">if</span> i%<span class="number">100000000</span> == <span class="number">0</span> &#123;</span><br><span class="line">			log.Printf(<span class="string">&quot;add\n&quot;</span>)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	data := []<span class="type">byte</span>(str)</span><br><span class="line">	dataList = <span class="built_in">append</span>(dataList, <span class="type">string</span>(data))</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">len</span>(dataList)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>add_test.go</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> add</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;testing&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">BenchmarkAdd</span><span class="params">(b *testing.B)</span></span> &#123;</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; b.N; i++ &#123;</span><br><span class="line">		Add(<span class="string">&quot;go-programming-tour-book&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>参考 <a target="_blank" rel="noopener" href="https://pkg.go.dev/cmd/go#hdr-Testing_flags">go test
flags</a></p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cpu profile</span></span><br><span class="line">go <span class="built_in">test</span> -bench=. -cpuprofile=cpu.profile</span><br><span class="line"></span><br><span class="line"><span class="comment"># memory profile</span></span><br><span class="line">go <span class="built_in">test</span> -bench=. -memprofile=mem.profile</span><br></pre></td></tr></table></figure>
<h2 id="delve">delve</h2>
<blockquote>
<p>Delve aims to be a very simple and powerful tool, but can be
confusing if you're not used to using a source level debugger in a
compiled language. This document will provide all the information you
need to get started debugging your Go programs.</p>
</blockquote>
<h3 id="golang-debugging-code-example">Golang Debugging Code
Example</h3>
<blockquote>
<p>path = 'prof/fib/fib.go'</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> m = <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">int</span>]<span class="type">int</span>, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> _, n := <span class="keyword">range</span> []<span class="type">int</span>&#123;<span class="number">5</span>, <span class="number">1</span>, <span class="number">9</span>, <span class="number">98</span>, <span class="number">6</span>&#125; &#123;</span><br><span class="line">        x := fib(n)</span><br><span class="line">        fmt.Println(n, <span class="string">&quot;fib&quot;</span>, x)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">fib</span><span class="params">(n <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> n &lt; <span class="number">2</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> n</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> f <span class="type">int</span></span><br><span class="line">    <span class="keyword">if</span> v, ok := m[n]; ok &#123;</span><br><span class="line">        f = v</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        f = fib(n<span class="number">-2</span>) + fib(n<span class="number">-1</span>)</span><br><span class="line">        m[n] = f</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> f</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 执行delve</span></span><br><span class="line">dlv debug prof/fib/fib.go</span><br></pre></td></tr></table></figure>
<p>命令基本不用多解释，和 <code>gdb</code> 基本完全一致。</p>
<h3 id="stack">stack</h3>
<blockquote>
<p><code>stack</code> 命令输出当前的 stack trac，在 stack
的输出中，会包含 <code>frame</code> 信息。</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># print stack trace</span></span><br><span class="line">stack</span><br><span class="line"></span><br><span class="line"><span class="comment">#0  0x00000000004666e0 in _rt0_amd64_linux</span></span><br><span class="line"><span class="comment">#   at /usr/local/go/src/runtime/rt0_linux_amd64.s:8</span></span><br><span class="line"><span class="comment">#1  0x0000000000000000 in ???</span></span><br><span class="line"><span class="comment">#   at :0</span></span><br><span class="line"><span class="comment">#   error: NULL address</span></span><br></pre></td></tr></table></figure>
<h3 id="goroutine和goroutines">goroutine和goroutines</h3>
<blockquote>
<p>goroutine相关的命令有两条：</p>
<ul>
<li>goroutines : List program goroutines.</li>
<li>goroutine : Shows or changes current goroutine</li>
</ul>
</blockquote>
<h3 id="frame">frame</h3>
<blockquote>
<p><code>frame</code> 可以设置当前frame，或者指定后续的
<code>command</code> 在指定的 frame 上执行。</p>
</blockquote>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Set the current frame, <span class="built_in">or</span> <span class="keyword">execute</span> <span class="keyword">command</span> <span class="keyword">on</span> <span class="keyword">a</span> different frame.</span><br><span class="line"></span><br><span class="line">        frame <span class="symbol">&lt;m&gt;</span></span><br><span class="line">        frame <span class="symbol">&lt;m&gt;</span> <span class="symbol">&lt;command&gt;</span></span><br><span class="line"></span><br><span class="line">The <span class="keyword">first</span> form sets frame used by subsequent commands such <span class="keyword">as</span> <span class="string">&quot;print&quot;</span> <span class="built_in">or</span> <span class="string">&quot;set&quot;</span>.</span><br><span class="line">The second form runs the <span class="keyword">command</span> <span class="keyword">on</span> the given frame.</span><br></pre></td></tr></table></figure>
<h3 id="list">list</h3>
<blockquote>
<p><code>list</code> 显示源代码，并且可以指定 goroutine 和 frame</p>
</blockquote>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Show <span class="selector-tag">source</span> <span class="selector-tag">code</span>.</span><br><span class="line"></span><br><span class="line">        <span class="selector-attr">[goroutine &lt;n&gt;]</span> <span class="selector-attr">[frame &lt;m&gt;]</span> list <span class="selector-attr">[&lt;locspec&gt;]</span></span><br><span class="line"></span><br><span class="line">Show <span class="selector-tag">source</span> around current point or provided locspec.</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用 包.函数 增加一个断点</span></span><br><span class="line">b main.main</span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行程序</span></span><br><span class="line">r</span><br><span class="line"></span><br><span class="line"><span class="comment"># 进入main函数</span></span><br><span class="line">n</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看当前执行代码</span></span><br><span class="line">list</span><br><span class="line"><span class="comment"># &gt; main.main() ./fib.go:7 (hits goroutine(1):1 total:1) (PC: 0x49b18f)</span></span><br><span class="line"><span class="comment">#      2:</span></span><br><span class="line"><span class="comment">#      3: import &quot;fmt&quot;</span></span><br><span class="line"><span class="comment">#      4:</span></span><br><span class="line"><span class="comment">#      5: var m = make(map[int]int)</span></span><br><span class="line"><span class="comment">#      6:</span></span><br><span class="line"><span class="comment"># =&gt;   7: func main() &#123;</span></span><br><span class="line"><span class="comment">#      8:         for _, n := range []int&#123;5, 1, 9, 98, 6&#125; &#123;</span></span><br><span class="line"><span class="comment">#      9:                 x := fib(n)</span></span><br><span class="line"><span class="comment">#     10:                 fmt.Println(n, &quot;fib&quot;, x)</span></span><br><span class="line"><span class="comment">#     11:         &#125;</span></span><br><span class="line"><span class="comment">#     12: &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 为了方便调试，我们在以下行添加一个断点</span></span><br><span class="line"><span class="comment"># fmt.Println(n, &quot;fib&quot;, x)</span></span><br><span class="line"><span class="comment"># 通过函数的相对行数打断点</span></span><br><span class="line">b main.main:3</span><br><span class="line"><span class="comment"># 也可以通过文件名加绝对行数打断点</span></span><br><span class="line"><span class="comment"># b ./fib.go:10</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 继续</span></span><br><span class="line">c</span><br><span class="line"><span class="comment"># &gt; main.main() ./fib.go:10 (hits goroutine(1):1 total:1) (PC: 0x49b272)</span></span><br><span class="line"><span class="comment">#      5: var m = make(map[int]int)</span></span><br><span class="line"><span class="comment">#      6:</span></span><br><span class="line"><span class="comment">#      7: func main() &#123;</span></span><br><span class="line"><span class="comment">#      8:         for _, n := range []int&#123;5, 1, 9, 98, 6&#125; &#123;</span></span><br><span class="line"><span class="comment">#      9:                 x := fib(n)</span></span><br><span class="line"><span class="comment"># =&gt;  10:                 fmt.Println(n, &quot;fib&quot;, x)</span></span><br><span class="line"><span class="comment">#     11:         &#125;</span></span><br><span class="line"><span class="comment">#     12: &#125;</span></span><br><span class="line"><span class="comment">#     13:</span></span><br><span class="line"><span class="comment">#     14: func fib(n int) int &#123;</span></span><br><span class="line"><span class="comment">#     15:         if n &lt; 2 &#123;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看x的值</span></span><br><span class="line"><span class="comment">#5</span></span><br><span class="line"><span class="built_in">print</span> x</span><br><span class="line"></span><br><span class="line"><span class="comment"># 也可以通过 display 在每次执行后都输出x，我觉得这里用watch来表示更加直观</span></span><br><span class="line">display -a x</span><br></pre></td></tr></table></figure>
<h2 id="引用">引用</h2>
<p><a target="_blank" rel="noopener" href="https://golang2.eddycjy.com/posts/ch6/01-pprof-1/">6.1 Go
大杀器之性能剖析 PProf（上）</a></p>
<p><a
target="_blank" rel="noopener" href="https://github.com/google/pprof/blob/main/doc/README.md">golang
pprof document</a></p>
<p><a
target="_blank" rel="noopener" href="https://chai2010.cn/advanced-go-programming-book/ch3-asm/ch3-09-debug.html">Go语言高级编程</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/go-delve/delve/tree/master">delve</a></p>
<p><a
target="_blank" rel="noopener" href="https://golang.cafe/blog/golang-debugging-with-delve.html">Golang
Debugging With Delve [Step by Step]</a></p>
<p><a
target="_blank" rel="noopener" href="https://github.com/go-delve/delve/blob/master/Documentation/cli/README.md">Configuration
and Command History</a></p>

    </div>

    
    
    

    <footer class="post-footer">

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2024/04/24/Golang%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B%E6%80%BB%E7%BB%93/" rel="prev" title="Golang异步编程总结">
                  <i class="fa fa-angle-left"></i> Golang异步编程总结
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2024/07/25/calcite%E5%85%A5%E9%97%A8-Volcano-Optimizer/" rel="next" title="calcite入门-- Volcano Optimizer">
                  calcite入门-- Volcano Optimizer <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments utterances-container"></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2026</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">2183814023</span>
  </div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>
<script class="next-config" data-name="utterances" type="application/json">{"enable":true,"repo":"0x822a5b87/blog-comments","issue_term":"pathname","theme":"github-light"}</script>
<script src="/js/third-party/comments/utterances.js" defer></script>

</body>
</html>
