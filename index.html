<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 8.1.1">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css" integrity="sha256-VHqXKFhhMxcpubYf9xiWdCiojEbY9NexQ4jh8AxbvcM=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"0x822a5b87.github.io","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.26.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"codeblock":{"theme":{"light":"stackoverflow-light","dark":"stackoverflow-light"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":true,"style":"flat"},"fold":{"enable":false,"height":500},"language":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"utterances","storage":true,"lazyload":false,"nav":null,"activeClass":"utterances"},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js" defer></script>

    <meta name="description" content="到码头整点薯条吃">
<meta property="og:type" content="website">
<meta property="og:title" content="0x822a5b87的博客">
<meta property="og:url" content="https://0x822a5b87.github.io/index.html">
<meta property="og:site_name" content="0x822a5b87的博客">
<meta property="og:description" content="到码头整点薯条吃">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="2183814023">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://0x822a5b87.github.io/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>0x822a5b87的博客</title>
  








  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
<script src="/js/utils.js" defer></script><script src="/js/motion.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/next-boot.js" defer></script>

  

  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/11.10.1/mermaid.min.js","integrity":"sha256-BmQmdWDS8X2OTbrwELWK366LV6escyWhHHe0XCTU/Hk="}}</script>
  <script src="/js/third-party/tags/mermaid.js" defer></script>





  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"all","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js" defer></script>



  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">0x822a5b87的博客</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">到码头整点薯条吃</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">2183814023</p>
  <div class="site-description" itemprop="description">到码头整点薯条吃</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">43</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">39</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://0x822a5b87.github.io/2026/01/23/CUDA%E7%BC%96%E7%A8%8B%E5%85%A5%E9%97%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="2183814023">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="0x822a5b87的博客">
      <meta itemprop="description" content="到码头整点薯条吃">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | 0x822a5b87的博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2026/01/23/CUDA%E7%BC%96%E7%A8%8B%E5%85%A5%E9%97%A8/" class="post-title-link" itemprop="url">CUDA编程入门</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2026-01-23 09:09:55" itemprop="dateCreated datePublished" datetime="2026-01-23T09:09:55+08:00">2026-01-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2026-01-25 14:11:51" itemprop="dateModified" datetime="2026-01-25T14:11:51+08:00">2026-01-25</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="环境配置">环境配置</h1>
<figure>
<img src="\images\cuda\效果图.png" alt="效果图">
<figcaption aria-hidden="true">效果图</figcaption>
</figure>
<p>CUDA
开发环境的配置流程虽不算复杂，但主流的实现方案均存在明显的体验短板：</p>
<ul>
<li><strong>macOS 远程对接 Linux 开发</strong>：这种在 macOS
系统下通过远程连接 Linux 环境开发的方式，核心痛点包括：
<ul>
<li>多数 IDE
对跨平台编译、调试（DEBUG）的支持度不足，功能完整性和稳定性欠佳；</li>
<li>开发过程中易遇到不影响核心功能但影响体验的小问题，整体使用感受较差；</li>
<li>核心问题在于算力资源（算例）多按小时租赁且成本较高，为控制开销频繁启停实例时，需反复配置开发环境，严重降低开发效率。</li>
</ul></li>
<li><strong>Windows
原生开发</strong>：该方案能满足基础开发流程需求，但核心问题集中在适配性和工具层面：
<ul>
<li>行业内多数 CUDA 相关依赖框架、技术文档均基于 Linux
环境开发和撰写，迁移到 Windows
时，需额外花费精力寻找适配方案，甚至手动调整兼容逻辑；</li>
<li>核心开发工具 Visual Studio
体积臃肿、配置项繁杂，对新手不友好，且易因配置不当引发环境问题。</li>
</ul></li>
</ul>
<p>经过我一段时间的摸索和测试，目前找到了一个比较好的解决方案：<code>Windows</code>
+ <code>WSL(Ubuntu)</code> + <code>VSCode(WSL Plugin)</code>
来作为开发环境，即有极高的兼容性，同时对于习惯于 linux
开发的我来说更顺手。最重要的是，这一套环境的配置远低于其他的环境配置，这里我们介绍一下怎么搭建这个开发环境。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2026/01/23/CUDA%E7%BC%96%E7%A8%8B%E5%85%A5%E9%97%A8/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://0x822a5b87.github.io/2026/01/16/build-my-own-raft-from-scratch/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="2183814023">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="0x822a5b87的博客">
      <meta itemprop="description" content="到码头整点薯条吃">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | 0x822a5b87的博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2026/01/16/build-my-own-raft-from-scratch/" class="post-title-link" itemprop="url">build my own raft from scratch</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2026-01-16 15:31:43" itemprop="dateCreated datePublished" datetime="2026-01-16T15:31:43+08:00">2026-01-16</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2026-01-22 11:59:57" itemprop="dateModified" datetime="2026-01-22T11:59:57+08:00">2026-01-22</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote>
<p>本文是自己动手实现raft的前置文章，旨在分析raft协议的内部实现原理。作者在网上搜索了大量的文献和资料，向这些作者表达我的敬意。这里也推荐阅读本文的人可以参考这几篇经典的文章：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://raft.github.io/raft.pdf">raft原论文</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/maemual/raft-zh_cn/blob/master/raft-zh_cn.md">raft论文（翻译版）</a></li>
<li><a target="_blank" rel="noopener" href="https://thesecretlivesofdata.com/raft/">raft算法可视化</a></li>
</ul>
</blockquote>
<h1 id="概述">概述</h1>
<p>在我们探讨 <code>raft</code>
算法之前，我们需要搞清楚为什么我们需要一个如此复杂的算法：我们用数据库举例：</p>
<p>在传统的单机数据库下，我们其实也会有所谓的<strong>一致性需求</strong>
-- 就是我们的事务。当我们在执行一个 SQL 语句时会存在 IO 操作，而这个 IO
操作和我们分布式系统的 IO 操作是没有本质区别的 --
他们都有概率失败。例如：假设我们存在一个 SQL
写入语句，这个语句写入的字段中包含了一个超大字段，这个超大字段超过了操作系统的单次
IO 写入大小，那么操作系统必然会把这个写入语句拆分成多次 IO
操作。那现在我们面临的问题是：</p>
<ul>
<li>假设这个语句被拆分为两次 IO 操作：
<ul>
<li>第一次 IO 操作成功了，第二次 IO 操作时磁盘满了无法写入怎么办？</li>
<li>第一次 IO 操作成功了，在第二次 IO 操作之前机器重启了怎么办？</li>
</ul></li>
</ul>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2026/01/16/build-my-own-raft-from-scratch/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://0x822a5b87.github.io/2026/01/14/build-my-own-docker-from-scratch-network/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="2183814023">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="0x822a5b87的博客">
      <meta itemprop="description" content="到码头整点薯条吃">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | 0x822a5b87的博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2026/01/14/build-my-own-docker-from-scratch-network/" class="post-title-link" itemprop="url">build my own docker from scratch: network</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2026-01-14 16:45:18" itemprop="dateCreated datePublished" datetime="2026-01-14T16:45:18+08:00">2026-01-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2026-01-22 11:59:57" itemprop="dateModified" datetime="2026-01-22T11:59:57+08:00">2026-01-22</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote>
<p><strong>需要注意的是，linux下的网络编程是一个非常琐碎的过程，所以我们在这里只是实现了最简单的版本：</strong></p>
<ul>
<li>只支持 <code>IPv4</code>；</li>
<li>只支持通过 <code>Linux Bridge</code>/<code>Veth Pari</code>；</li>
<li>对 <code>Subnet</code>
的网段进行了限制，并且只允许通过后台默认分配，不允许用户自定义；</li>
</ul>
<p>在实现的过程中，我们也有很多的地方因为太过于繁琐直接省略了：</p>
<ul>
<li>对于我们分配网段/分配IP的管理，只记录在内存中，并没有做持久化；</li>
<li>虽然根据职责对系统进行了分层，但是整个的架构和接口设计都比较随意；</li>
<li><code>EndpointId</code> 和 <code>ContainerId</code>
没有分开，也就限制了我们每个容器只能接入一个网络；</li>
<li>虽然对各个组件之间通过接口做了解耦，但是实际在代码实现中未实现完全解耦；</li>
<li>错误处理不严谨，很多地方在失败时都没有进行回滚操作；</li>
<li>没有增加跨子网路由，所以现在只能容器之间通信，而不能实现容器通过宿主机的网卡与外网通信。</li>
</ul>
</blockquote>
<p>在我们前面的文章 <a href="https://0x822a5b87.github.io/2025/12/18/build-my-own-docker-from-scratch/">build
my own docker from scratch</a> 中，我们实现了：</p>
<ul>
<li>通过 <code>namespace</code> 对容器实现资源虚拟化；</li>
<li>通过 <code>cgroup</code> 对容器的资源进行限制和管理；</li>
<li>通过 <code>daemon</code> 进程来实现对整体资源的管理；</li>
</ul>
<p>今天我们要开始实现一个对 <code>docker</code>
来说至关重要的特性：<code>network namespace</code>
的管理。从这一节，我们也可以体会到为什么我们要使用一个额外的
<code>daemon</code> 进程来对我们容器进行管理 --
从之前的视角中，我们可以看到大量的缺点：</p>
<ul>
<li>引入了额外的复杂性；</li>
<li>大量通过 <code>UDS</code>
通信导致的异步行为使得程序的编码和DEBUG都更加困难；</li>
<li>中心化的服务降低了程序的健壮性。</li>
</ul>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2026/01/14/build-my-own-docker-from-scratch-network/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://0x822a5b87.github.io/2025/12/23/Go-Rust-CPP%E7%9A%84Covariance-Contravariance-Invariance/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="2183814023">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="0x822a5b87的博客">
      <meta itemprop="description" content="到码头整点薯条吃">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | 0x822a5b87的博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/12/23/Go-Rust-CPP%E7%9A%84Covariance-Contravariance-Invariance/" class="post-title-link" itemprop="url">Go/Rust/CPP的Covariance/Contravariance/Invariance</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-12-23 10:40:04" itemprop="dateCreated datePublished" datetime="2025-12-23T10:40:04+08:00">2025-12-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2026-01-22 11:59:57" itemprop="dateModified" datetime="2026-01-22T11:59:57+08:00">2026-01-22</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="发现问题">发现问题</h1>
<p>最近在尝试实现一个简单的 <a target="_blank" rel="noopener" href="https://github.com/0x822a5b87/tiny-docker/tree/main">docker</a>，在实现的过程中我试图将对linux的cgroup文件操作抽象为一个独立的接口
<code>subsystem</code>，但是对于不同的类型的文件他的结构完全不一样：</p>
<ul>
<li>对于 <code>cgroup.procs</code>，他的文件中存储的是一个以
<code>\n</code> 分割的 <code>pid</code> 数组；</li>
<li>对于
<code>cpu.max</code>，他的文件中存储的是以空格分隔的两个数字；</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cat /sys/fs/cgroup/system.slice/docker-0a7f5c9459f832ac7bb539e6e61dac51a4a4f66c5dbc1bbb963d0ec3f01d31ae.scope/cgroup.procs</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">1435205</span></span><br><span class="line"></span><br><span class="line">cat /sys/fs/cgroup/system.slice/docker-0a7f5c9459f832ac7bb539e6e61dac51a4a4f66c5dbc1bbb963d0ec3f01d31ae.scope/cpu.max</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">max 100000</span></span><br></pre></td></tr></table></figure>
<p>所以，我尝试直接将他做出如下抽象：</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2025/12/23/Go-Rust-CPP%E7%9A%84Covariance-Contravariance-Invariance/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://0x822a5b87.github.io/2025/12/18/build-my-own-docker-from-scratch/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="2183814023">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="0x822a5b87的博客">
      <meta itemprop="description" content="到码头整点薯条吃">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | 0x822a5b87的博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/12/18/build-my-own-docker-from-scratch/" class="post-title-link" itemprop="url">build my own docker from scratch</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-12-18 23:24:46" itemprop="dateCreated datePublished" datetime="2025-12-18T23:24:46+08:00">2025-12-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2026-01-22 11:59:57" itemprop="dateModified" datetime="2026-01-22T11:59:57+08:00">2026-01-22</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="build-my-own-docker-from-scratch">build my own docker from
scratch</h1>
<blockquote>
<p>Docker is an OS‑level virtualization (or containerization) platform,
which allows applications to share the host OS kernel instead of running
a separate guest OS like in traditional virtualization.</p>
</blockquote>
<h1 id="前言">前言</h1>
<blockquote>
<p>本文基于 <code>OpenCloudOS</code> 操作系统以及 <code>x86_64</code>
平台，<code>go1.24.11</code> 语言开发测试，全部代码位于 <a target="_blank" rel="noopener" href="https://github.com/0x822a5b87/tiny-docker">tiny-docker</a>。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line marked"><span class="built_in">uname</span> -a</span><br><span class="line"><span class="comment"># Linux VM-0-10-opencloudos 6.6.117-45.1.oc9.x86_64 #1 SMP Tue Dec 16 11:49:47 CST 2025 x86_64 x86_64 x86_64 GNU/Linux</span></span><br><span class="line"></span><br><span class="line marked">go version</span><br><span class="line"><span class="comment"># go version go1.24.11 linux/amd64</span></span><br><span class="line"></span><br><span class="line marked">docker --version</span><br><span class="line"><span class="comment"># Docker version 29.1.3, build f52814d</span></span><br></pre></td></tr></table></figure>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://www.docker.com/">Docker</a> 是基于 Linux Namespace
和 Cgroup 实现的轻量级虚拟化平台。相较于传统虚拟机（如 <a target="_blank" rel="noopener" href="https://www.virtualbox.org/">Oracle VirtualBox</a>），Docker
无需模拟硬件和运行独立内核，仅通过内核级的资源隔离与限制实现
“虚拟环境”，因此更轻量级（毫秒级启动）、资源占用更低 ——
同一台宿主机上的所有容器<strong>共享宿主机内核</strong>，这是容器与虚拟机的核心区别。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2025/12/18/build-my-own-docker-from-scratch/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://0x822a5b87.github.io/2025/12/13/uCore%E5%B9%B6%E5%8F%91/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="2183814023">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="0x822a5b87的博客">
      <meta itemprop="description" content="到码头整点薯条吃">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | 0x822a5b87的博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/12/13/uCore%E5%B9%B6%E5%8F%91/" class="post-title-link" itemprop="url">uCore并发</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-12-13 16:00:35" itemprop="dateCreated datePublished" datetime="2025-12-13T16:00:35+08:00">2025-12-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2026-01-22 11:59:57" itemprop="dateModified" datetime="2026-01-22T11:59:57+08:00">2026-01-22</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="ucore并发">uCore并发</h1>
<pre><code class="highlight mermaid">sequenceDiagram
    title 银行家算法 - 安全场景（sequenceDiagram）
    银行家算法 -&gt;&gt; 数据结构存储: 初始化请求（读取Available/Allocation/Need）
    数据结构存储--&gt;&gt;银行家算法: 返回初始数据（Available=&#123;&#125;, Work=&#123;&#125;, Finish=[F,F]）
    
    %% 第一次循环:找满足条件的线程
    银行家算法 -&gt;&gt; 银行家算法: 遍历线程，检查条件（Need[i][j] ≤ Work[j] 且 Finish[i]=F）
    银行家算法 -&gt;&gt; 数据结构存储: 查询线程1的Need/Finish
    数据结构存储--&gt;&gt;银行家算法: 线程1:Need=&#123;200:1&#125;，Finish=F
    银行家算法 -&gt;&gt; 银行家算法: 线程1:Need &gt; Work → 不满足
    银行家算法 -&gt;&gt; 数据结构存储: 查询线程2的Need/Finish
    数据结构存储--&gt;&gt;银行家算法: 线程2:Need=&#123;&#125;，Finish=F
    银行家算法 -&gt;&gt; 银行家算法: 线程2:Need ≤ Work → 满足
    
    %% 模拟线程2释放资源
    银行家算法 -&gt;&gt; 数据结构存储: 模拟线程2执行完毕，请求更新Work（Work += 线程2的Allocation&#123;200:1&#125;）
    数据结构存储--&gt;&gt;银行家算法: Work更新成功（Work=&#123;200:1&#125;）
    银行家算法 -&gt;&gt; 数据结构存储: 请求标记线程2的Finish=true
    数据结构存储--&gt;&gt;银行家算法: Finish更新成功（Finish=[F,T]）
    
    %% 第二次循环:找满足条件的线程
    银行家算法 -&gt;&gt; 银行家算法: 重新遍历线程（仅线程1未完成）
    银行家算法 -&gt;&gt; 数据结构存储: 查询线程1的Need/Work
    数据结构存储--&gt;&gt;银行家算法: 线程1:Need=&#123;200:1&#125;，Work=&#123;200:1&#125;
    银行家算法 -&gt;&gt; 银行家算法: 线程1:Need ≤ Work → 满足
    
    %% 模拟线程1释放资源
    银行家算法 -&gt;&gt; 数据结构存储: 模拟线程1执行完毕，请求更新Work（Work += 线程1的Allocation&#123;100:1&#125;）
    数据结构存储--&gt;&gt;银行家算法: Work更新成功（Work=&#123;100:1,200:1&#125;）
    银行家算法 -&gt;&gt; 数据结构存储: 请求标记线程1的Finish=true
    数据结构存储--&gt;&gt;银行家算法: Finish更新成功（Finish=[T,T]）
    
    %% 判定结果
    银行家算法 -&gt;&gt; 银行家算法: 检查所有Finish是否为true
    银行家算法--&gt;&gt;外部: 输出判定结果 → 系统安全（无死锁风险）</code></pre>
<h2 id="引言">引言</h2>
<h3 id="线程定义">线程定义</h3>
<p>简单地说，线程是进程的组成部分，进程可包含1 –
n个线程，属于同一个进程的线程共享进程的资源， 比如
<code>地址空间</code>、打开的文件等。基本的线程由线程ID、执行状态、当前指令指针
(PC)、寄存器集合和栈组成。
线程是可以被操作系统或用户态调度器独立调度（Scheduling）和分派（Dispatch）的基本单位。<strong>进程是线程的资源容器，
线程成为了程序的基本执行实体。</strong></p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2025/12/13/uCore%E5%B9%B6%E5%8F%91/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://0x822a5b87.github.io/2025/12/13/uCore%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="2183814023">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="0x822a5b87的博客">
      <meta itemprop="description" content="到码头整点薯条吃">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | 0x822a5b87的博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/12/13/uCore%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/" class="post-title-link" itemprop="url">uCore进程间通信</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-12-13 09:07:14" itemprop="dateCreated datePublished" datetime="2025-12-13T09:07:14+08:00">2025-12-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2026-01-22 11:59:57" itemprop="dateModified" datetime="2026-01-22T11:59:57+08:00">2026-01-22</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="进程间通信">进程间通信</h1>
<h2 id="基于文件的管道">基于文件的管道</h2>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// os/src/fs/pipe.rs</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">Pipe</span> &#123;</span><br><span class="line">    readable: <span class="type">bool</span>,</span><br><span class="line">    writable: <span class="type">bool</span>,</span><br><span class="line">    buffer: Arc&lt;Mutex&lt;PipeRingBuffer&gt;&gt;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通过 <code>buffer</code>
字段还可以找到该管道端所在的管道自身。后续我们将为它实现
<code>File</code> Trait ，之后它便可以通过文件描述符来访问。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// os/src/fs/pipe.rs</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> RING_BUFFER_SIZE: <span class="type">usize</span> = <span class="number">32</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[derive(Copy, Clone, PartialEq)]</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">RingBufferStatus</span> &#123;</span><br><span class="line">    FULL,</span><br><span class="line">    EMPTY,</span><br><span class="line">    NORMAL,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">PipeRingBuffer</span> &#123;</span><br><span class="line">    arr: [<span class="type">u8</span>; RING_BUFFER_SIZE],</span><br><span class="line">    head: <span class="type">usize</span>,</span><br><span class="line">    tail: <span class="type">usize</span>,</span><br><span class="line">    status: RingBufferStatus,</span><br><span class="line">    write_end: <span class="type">Option</span>&lt;Weak&lt;Pipe&gt;&gt;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2025/12/13/uCore%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://0x822a5b87.github.io/2025/12/09/uCore%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="2183814023">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="0x822a5b87的博客">
      <meta itemprop="description" content="到码头整点薯条吃">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | 0x822a5b87的博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/12/09/uCore%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/" class="post-title-link" itemprop="url">uCore文件系统</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-12-09 10:23:14" itemprop="dateCreated datePublished" datetime="2025-12-09T10:23:14+08:00">2025-12-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2026-01-22 11:59:57" itemprop="dateModified" datetime="2026-01-22T11:59:57+08:00">2026-01-22</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="文件系统">文件系统</h1>
<figure>
<img src="/images/20251208/layout.png" alt="layout">
<figcaption aria-hidden="true">layout</figcaption>
</figure>
<h2 id="整体逻辑">整体逻辑</h2>
<pre><code class="highlight mermaid">graph BT
    %% 核心模块：easy-fs（文件系统核心逻辑）
    subgraph easy-fs [&quot;easy-fs（文件系统核心算法）&quot;]
        direction BT
        subgraph BD [&quot;抽象层：BlockDevice（块设备接口）&quot;]
            direction TB
            read_block(&quot;read_block&quot;)
            write_block(&quot;write_block&quot;)
        end

        subgraph BC [&quot;缓存层：BlockCache（块缓存）&quot;]
            direction TB
            read(&quot;read&quot;)
            modify(&quot;modify&quot;)
            bc_other(&quot;其他缓存操作...&quot;)
        end

        subgraph LAY [&quot;布局层：存储结构定义&quot;]
            direction TB
            SB(&quot;SuperBlock（超级块）&quot;)
            BM(&quot;Bitmap（位图）&quot;)
            DI(&quot;DiskInode（磁盘索引节点）&quot;)
            DE(&quot;DirEntry（目录项）&quot;)
            DB(&quot;DataBlock（数据块）&quot;)
        end

        subgraph BMGR [&quot;管理层：文件系统实例/接口&quot;]
            direction TB
            EFS(&quot;EasyFileSystem（文件系统实例）&quot;)
            INODE(&quot;Inode（文件/目录操作接口）&quot;)
        end

        %% easy-fs 内部链路（修正方向）
        BD --&gt;|读写物理块| BC
        BC --&gt;|缓存读写| LAY
        LAY --&gt;|基于布局实现| BMGR
    end

    %% 辅助工具：easy-fs 配套工具（宿主机侧）
    subgraph easy-fs-tools [&quot;easy-fs-tools（宿主机工具）&quot;]
        direction TB
        pack(&quot;easy_fs_pack（打包工具）&quot;)
        fuse(&quot;easy-fs-fuse（FUSE调试工具）&quot;)
    end
    easy-fs --&gt;|依赖核心逻辑| pack
    pack --&gt;|生成镜像| fs_img[&quot;fs.img（raw格式镜像）&quot;]
    easy-fs --&gt;|适配FUSE接口| fuse
    fuse --&gt;|挂载调试| fs_img

    %% QEMU（虚拟硬件层）
    subgraph qemu [&quot;QEMU（虚拟硬件）&quot;]
        direction TB
        drive(&quot;-drive file=fs.img（后端存储）&quot;)
        virtio_dev(&quot;-device virtio-blk-device（虚拟块设备）&quot;)
    end
    fs_img --&gt;|作为后端存储| drive
    drive --&gt;|绑定到虚拟设备| virtio_dev

    %% os 内核（驱动+文件系统调用）
    subgraph os [&quot;os（内核层）&quot;]
        direction TB
        subgraph VIRTIO [&quot;驱动层：VirtIOBlock&quot;]
            direction TB
            virtio_bd(&quot;实现 BlockDevice 接口&quot;)
            virtio_ops(&quot;virtio-blk 读写操作&quot;)
        end
        subgraph FS_CALL [&quot;应用层：文件系统调用&quot;]
            direction TB
            fs_open(&quot;open/read/write&quot;)
            fs_exec(&quot;执行ELF文件&quot;)
        end
    end
    %% 内核链路
    qemu --&gt;|暴露虚拟硬件| virtio_dev
    virtio_dev --&gt;|内核枚举设备| VIRTIO
    VIRTIO --&gt;|适配接口| easy-fs
    easy-fs --&gt;|提供文件操作| FS_CALL</code></pre>
<h2 id="文件与文件描述符">文件与文件描述符</h2>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2025/12/09/uCore%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://0x822a5b87.github.io/2025/12/02/ucore%E8%BF%9B%E7%A8%8B%E5%8F%8A%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="2183814023">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="0x822a5b87的博客">
      <meta itemprop="description" content="到码头整点薯条吃">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | 0x822a5b87的博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/12/02/ucore%E8%BF%9B%E7%A8%8B%E5%8F%8A%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86/" class="post-title-link" itemprop="url">uCore进程及进程管理</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-12-02 11:09:36" itemprop="dateCreated datePublished" datetime="2025-12-02T11:09:36+08:00">2025-12-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2026-01-22 11:59:57" itemprop="dateModified" datetime="2026-01-22T11:59:57+08:00">2026-01-22</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="ucore进程及进程管理">uCore：进程及进程管理</h1>
<blockquote>
<p>我们将开发一个用户 <strong>终端</strong> (Terminal) 或
<strong>命令行</strong> (Command Line Application, 俗称
<strong>Shell</strong> ) ， 形成用户与操作系统进行交互的命令行界面
(Command Line Interface)。</p>
<p>为此，我们要对任务建立新的抽象： <strong>进程</strong>
，并实现若干基于 <strong>进程</strong> 的强大系统调用。</p>
</blockquote>
<pre><code class="highlight mermaid">flowchart LR
    subgraph init[&quot;初始化阶段：无用户任务&quot;]
        direction LR
        registers_0(&quot;registers.cx: idle运行状态&quot;):::pink
        current_0(&quot;current: None&quot;):::purple
        idle_task_cx_0(&quot;idle_task_cx: zero.ctx（占位）&quot;):::green
    end

    subgraph stage_1[&quot;阶段1：fetch_task&quot;]
        direction LR
        registers_1(&quot;registers.cx: task.cx（用户任务状态）&quot;):::pink
        current_1(&quot;current: Some(task)&quot;):::purple
        idle_task_cx_1(&quot;idle_task_cx: 原registers.cx（idle休眠状态）&quot;):::green
    end

    subgraph stage_2[&quot;阶段2：suspend&quot;]
        direction LR
        registers_2(&quot;registers.cx: idle运行状态（从idle_task_cx_1加载）&quot;):::pink
        current_2(&quot;current: None&quot;):::purple
        idle_task_cx_2(&quot;idle_task_cx: 原registers_1（用户任务挂起状态）&quot;):::green
    end

    subgraph stage_3[&quot;阶段3：exit→用户任务退出&quot;]
        direction LR
        registers_3(&quot;registers.cx: idle运行状态（从idle_task_cx_1加载）&quot;):::pink
        current_3(&quot;current: None&quot;):::purple
        idle_task_cx_3(&quot;idle_task_cx: 原idle_task_cx_1（无变化）&quot;):::green
    end

    subgraph TaskManager[&quot;TaskManager：就绪队列&quot;]
        t_task(&quot;task.cx: 用户任务挂起状态（仅suspend后存在）&quot;):::coral
    end

    %% 流转逻辑（补充关键动作标注）
    init --&gt;|init| stage_1
    stage_1 --&gt;|suspend| stage_2
    stage_1 --&gt;|exit| stage_3

    %% 状态转移细节
    current_1 --&gt;|take_current后add_task，共享task所有权| TaskManager
    registers_1 --&gt;|__switch保存用户任务状态到task.cx| t_task
    idle_task_cx_1 --&gt;|__switch加载idle状态到寄存器| registers_2
    idle_task_cx_1 --&gt;|__switch加载idle状态到寄存器| registers_3

    %% 样式定义（沿用你的设计）
    classDef pink fill:#FFCCCC,stroke:#333, color: #fff, font-weight:bold;
    classDef green fill: #696,color: #fff,font-weight: bold;
    classDef purple fill:#969,stroke:#333, font-weight: bold;
    classDef error fill:#bbf,stroke:#f66,stroke-width:2px,color:#fff,stroke-dasharray: 5 5;
    classDef coral fill:#f9f,stroke:#333,stroke-width:4px;
    classDef animate stroke-dasharray: 9,5,stroke-dashoffset: 900,animation: dash 25s linear infinite;</code></pre>
<h2 id="与进程有关的重要系统调用">与进程有关的重要系统调用</h2>
<h3 id="重要系统调用">重要系统调用</h3>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2025/12/02/ucore%E8%BF%9B%E7%A8%8B%E5%8F%8A%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://0x822a5b87.github.io/2025/11/21/ucore%E5%9C%B0%E5%9D%80%E7%A9%BA%E9%97%B4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="2183814023">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="0x822a5b87的博客">
      <meta itemprop="description" content="到码头整点薯条吃">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | 0x822a5b87的博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/11/21/ucore%E5%9C%B0%E5%9D%80%E7%A9%BA%E9%97%B4/" class="post-title-link" itemprop="url">uCore地址空间</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-11-21 17:11:09" itemprop="dateCreated datePublished" datetime="2025-11-21T17:11:09+08:00">2025-11-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2026-01-22 11:59:57" itemprop="dateModified" datetime="2026-01-22T11:59:57+08:00">2026-01-22</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote>
<p>在这个章节，我们会实现虚拟内存机制。</p>
</blockquote>
<h2 id="物理空间和虚拟空间">物理空间和虚拟空间</h2>
<blockquote>
<p>虚拟空间连续，物理空间不一定连续！</p>
</blockquote>
<pre><code class="highlight mermaid">flowchart LR
    %% 样式定义（避开关键字，用合法语法）
    classDef structStyle fill:#f0f8ff,stroke:#2c3e50,stroke-width:2px,rounded:10px
    classDef vaStyle fill:#fdf2f8,stroke:#9b59b6,stroke-width:2px,rounded:10px
    classDef vpnStyle fill:#fef7fb,stroke:#9b59b6,stroke-width:1px,rounded:8px,padding:10px
    classDef paStyle fill:#e8f4f8,stroke:#3498db,stroke-width:2px,rounded:10px
    classDef ppnStyle fill:#f0f8ff,stroke:#3498db,stroke-width:1px,rounded:8px,padding:10px
    classDef fieldStyle font-weight:bold,color:#2c3e50
    classDef connStyle stroke:#7f8c8d,stroke-width:1.5px,arrowheadStyle:fill:#7f8c8d

    %% 上层：结构体（连续字段）
    subgraph Struct[&quot;📦 TimeVal 结构体（连续虚拟内存视图）&quot;]
        direction TB
        sec[&quot;&lt;span class=&#x27;fieldStyle&#x27;&gt;sec&lt;/span&gt;&lt;br/&gt;usize (8字节)&quot;]:::fieldStyle
        usec[&quot;&lt;span class=&#x27;fieldStyle&#x27;&gt;usec&lt;/span&gt;&lt;br/&gt;usize (8字节)&quot;]:::fieldStyle
    end
    class Struct structStyle

    %% 中层：虚拟地址 VA（连续，跨2个虚拟页）
    subgraph VA[&quot;🌐 虚拟地址 VA（连续）&quot;]
        direction LR
        subgraph VPN0[&quot;VPN0（虚拟页0）&quot;]
            %% 修正：sec 位于 VPN0 末尾，VA = 页起始 + (4KB-8) = 0x40200000 + 0xFF8 = 0x40200FF8
            va_sec[&quot;0x40200FF8&lt;br/&gt;[页内偏移: 0xFF8 = 4KB-8]&quot;]
        end
        subgraph VPN1[&quot;VPN1（虚拟页1）&quot;]
            %% 修正：usec 位于 VPN1 起始，页内偏移 0x000
            va_usec[&quot;0x40201000&lt;br/&gt;[页内偏移: 0x000]&quot;]
        end
        note_va[&quot;页大小：4KB (0x1000)&lt;br/&gt;VPN0范围：0x40200000~0x40200FFF&lt;br/&gt;VPN1范围：0x40201000~0x40201FFF&quot;]
        class note_va vaStyle
    end
    class VA vaStyle

    %% 下层：物理地址 PA（离散）
    subgraph PA[&quot;💾 物理地址 PA（离散）&quot;]
        subgraph PPN0[&quot;PPN0（物理页0）&quot;]
            %% 物理页0起始 + 偏移0xFF8 = 0x8000 + 0xFF8 = 0x8FF8
            pa_sec[&quot;0x8FF8&lt;br/&gt;[页内偏移: 0xFF8]&quot;]
        end
        subgraph PPN1[&quot;PPN1（物理页1）&quot;]
            %% 物理页1起始 + 偏移0x000 = 0x4000 + 0x000 = 0x4000
            pa_usec[&quot;0x4000&lt;br/&gt;[页内偏移: 0x000]&quot;]
        end
        note_pa[&quot;物理页独立分配，地址不连续&lt;br/&gt;PPN0范围：0x8000~0x8FFF&lt;br/&gt;PPN1范围：0x4000~0x4FFF&quot;]
        class note_pa paStyle
    end
    class PA paStyle

    %% 映射关系（字段 → VA → PA）
    sec -.-&gt;|字段对应VA| va_sec:::connStyle
    usec -.-&gt;|字段对应VA| VPN1:::connStyle
    va_sec -.-&gt;|页表翻译（VPN0→PPN0）| pa_sec:::connStyle
    va_usec -.-&gt;|页表翻译（VPN1→PPN1）| pa_usec:::connStyle

    %% 核心结论标注（突出问题）
    conclusion[&quot;⚠️  核心问题：&lt;br/&gt;结构体VA连续（跨页边界），但映射的PA离散&lt;br/&gt;内核需拆为2段写入：&lt;br/&gt;1. PPN0的0x8FF8~0x8FFF（6字节？不，8字节刚好）&lt;br/&gt;2. PPN1的0x4000~0x4007&quot;]:::structStyle
    PA -.-&gt;|体现| conclusion:::connStyle</code></pre>
<h2 id="管理sv39多级页表">管理SV39多级页表</h2>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2025/11/21/ucore%E5%9C%B0%E5%9D%80%E7%A9%BA%E9%97%B4/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" title="下一页" aria-label="下一页" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2026</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">2183814023</span>
  </div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>
<script class="next-config" data-name="utterances" type="application/json">{"enable":true,"repo":"0x822a5b87/blog-comments","issue_term":"pathname","theme":"github-light"}</script>
<script src="/js/third-party/comments/utterances.js" defer></script>

</body>
</html>
